# 2장 URL과 리소스

# 2.1 인터넷의 리소스 탐색하기

url은 브라우저가 정보를 찾는데 필요한 리소스의 위치를 가리킨다.

url을 통해 http 및 다른 프로토콜을 통해 접근할 수 있다.

- URL: URI 라고 불리는 더 일반화된 부류의 부분집합 (대부분은 스킴//서버위치/경로의 구조)
- URI: URL 과 URN 으로 구성된 종합적인 개념
- URN: 리소스가 어디에 존재하든 상관없이 이름만으로 리소스 식별이 가능

https://www.naver.com/index.html 이라는 주소가 있을때

- https 는 `URL의 스킴`. 웹 클라이언트가 리소스에 어떻게 접근하는지 
- [www.naver.com](http://www.naver.com/) 은 `서버의 위치` . 리소스가 어디에 호스팅 되어 있는지
- /index.html 은 `리소스의 경로` 

<img src="./images//image-20231019012206420.png">

# 2.2 URL 문법

URL로 인터넷상 모든 리소스를 찾을 수 있지만, 리소스들은 각각 다른 스킴(http, ftp, smtp)를 통해 접근할 수 있으며 URL 문법은 스킴에 따라서 달라진다.



대부분의 URL은 일반 URL 문법을 따르고, 일반적으로 9개 부분으로 나뉜다

```
<스킴>://<사용자이름>:<비밀번호>@<호스트>:<포트>/<경로>;<파라미터>?<질의>#<프래그먼트>
```

| 컴포넌트   | 설명                                                         | 기본값           |
| ---------- | ------------------------------------------------------------ | ---------------- |
| **스킴**   | 리소스를 가져오려면 어떤 프로토콜을 사용하여 서버에 접근해야 하는지를 가리킴 | 없음             |
| 사용자이름 | 몇몇 스킴은 리소스에 접근 하기 위해 사용자 이름이 필요함     | anonymous        |
| 비밀번호   | 사용자의 비밀번호를 가리키며, 사용자 이름에 콜론(:)으로 이어서 기술함 | 이메일주소       |
| **호스트** | 리소스를 호스팅하는 서버의 호스트 명이나 IP 주소             | 없음             |
| 포트       | 리소스를 호스팅하는 서버가 열어놓은 포트 번호. 많은 스킴이 기본 포트를 가지고 있음(HTTP 기본 포트는 80임) | 스킴에 따라 다름 |
| **경로**   | 이전 컴포넌트와 빗금으로 구분함. 리소스가 서버 내 어디에 있는지를 가리킴. 경로 컴포넌트의 문법은 서버와 스킴에 따라 다름 | 없음             |
| 파라미터   | 특정 스킴들에서 입력 파라미터를 기술하는 용도로 사용됨. 파라미터는 이름/값을 쌍으로 가짐. 다른 파라미터나 경로의 일부와 세미콜론(;)으로 구분하여 기술하며, 여러 개를 가질 수 있음 | 없음             |
| 질의       | 스킴에서 애플리케이션(데이터베이스, 게시판, 검색엔진, 기타 인터넷 게이트웨이)에 파라미터를 전달하는 데 쓰임. URL 끝에 "?"로 구분함 | 없음             |
| 프래그먼트 | 리소스 조각이나 일부를 가리키는 이름. URL이 특정 객체를 가리킬 경우에 프래그먼트 필드는 서버에 전달되지 않음. 이는 클라이언트에서만 사용됨. URL 끝에서 "#" 문자로 구분함 | 없음             |

## 2.2.1 스킴: 사용할 프로토콜

URL을 해석하는 애플리케이션이 어떤 **프로토콜** 을 사용하여 리소스를 요청해야 하는지 알려주는 중요 정보다
- 어떤 프로토콜을 사용하여 주어진 리소스에 어떻게 접근하는지 알려주는 중요한 정보

- 알파벳으로 시작해야 하고 URL의 나머지 부분들과 첫 번째 콜론(:)으로 구분함

## 2.2.2 호스트와 포트

리소스를 호스팅하고 있는 장비와 그 장비 내에서 리소스에 접근할 수 있는 서버가 어디 있는지 알려준다
- 호스트: 접근하려고 하는 리소스를 가지고 있는 인터넷상의 호스트 장비. 주로 도메인명이나 IP 주소
- 포트: 서버가 열어놓은 네트워크 포트를 가리킴
  - TCP 프로토콜을 사용하는 HTTP는 기본 포트로 80을 사용함

## 2.2.3 사용자 이름과 비밀번호
데이터 접근 허용 권한 부여에 사용됨

```
ftp://ys:ysk1234@ftp.prep.ai.mit.edu/pub/gnu
```

* 사용자 이름이 ys. '@' 문자는 URL로부터 사용자 이름과 비밀번호 컴포넌트를 분리함
* 패스워드가 ysk1234 패스워드를 콜론(:)으로 분리하여 기술
* 사용자 이름이나 비밀번호 컴포넌트가 없는 경우에는  (예 : ftp://ftp.prep.ai.mit.edu/pub/gnu)
  * 사용자 이름 기본값: anonymous
  * 비밀번호 기본값: 브라우저마다 다름(IE: IEUser, 크롬: chrome@example.com)

## 2.2.4 경로
서버가 리소스의 위치를 찾는 데 사용하는 정보(리소스가 서버의 어디에 있는지 알려줌)

- 계층적 파일 시스템 경로와 유사한 구조를 가짐
  - '/' 문자를 기준으로 경로 조각으로 나뉨

https://www.naver.com/index.html 이라는 주소가 있을때

- /index.html 은 `리소스의 경로` 
- 각 경로조각은 자신만의 파라미터 컴포넌트를 가질 수 있음 

## 2.2.5 파라미터
많은 스킴(http)이 객체에 대한 호스트 및 경로 정보만으로는 리소스를 찾지 못한다

- 서버가 어떤 포트를 열어놓고 있는지,
- 리소스에 접근하기 위해 이름과 비밀번호를 명시했는지 등의 정보가 필요함

애플리케이션이 서버에 정확한 요청을 하는 데 필요한 입력 파라미터를 받는 데 사용한다

- 이름/값 쌍의 리스트
- 세미콜론(;)으로 URL 나머지 부분들과 구분한다
- 예시:ftp://prep.ai.mit.edu/pub/gnu;type=d
  - 파라미터: type=d

  - http://www.joeshardware.com/hammers;sale=false/index.html;graphics=true
    - 파라미터: sale=false, graphics=true



## 2.2.6 질의 문자열 (query)
데이터베이스 같은 서비스들은 요청받을 리소스 형식의 범위를 좁히기 위해서 질문이나 질의를 받을 수 있다.

마찬가지로 URL도 질의를 받을 수 있다. 

- 물음표(?) 우측의 값
- '&'로 나뉜 '이름=값' 쌍 형식의 문자열
- 예시: 
  - http://www.joes-hardware.com/inventorycheck.cgi?item=12731&color=blue
    - 질의 문자열: item=12731&color=blue
    

### 파라미터와 질의 문자열(Query String)의 차이

파라미터는 세미콜론 (;) 쿼리스트링은 &로 구분

* 쿼리스트링 예: `/search?keyword=apple&page=2`
  * 스프링에서는 @RequestParam 어노테이션을 사용 
* 파라미터 예: `ftp://prep.ai.mit.edu/pub/gnu;type=d`에서 `type=d`는 해당 리소스를 가져올 때 사용할 데이터 타입
  * 스프링에서는 기본적으로 URL 파라미터를 처리하는 기능이 제공되지않으므로 `HttpServletRequest` 객체를 사용하거나, URI를 직접 분석하여 처리

```java
@RequestMapping("/resource")
public String getResource(HttpServletRequest request) {
    String uri = request.getRequestURI();  // URI 추출
    String[] parts = uri.split(";");  // 세미콜론을 기준으로 분리

    if(parts.length > 1) {
        String typeParameter = parts[1];
        if("type=d".equals(typeParameter)) {
            // type=d를 처리하는 로직
        }
    }

    return "resourceResult";
}
```



## 2.2.7 프래그먼트
본래 리소스보다 더 작게 나눈 리소스의 특정 부분을 가리킨다. 

- 프래그먼트는 URL의 오른쪽에 샵(#) 우측의 값
- 예시:
  - 큰 한 개의 텍스트 문서에서 내부의 특정 절을 가리키려는 경우
  - HTML 문서에 있는 특정 이미지
  - http://www.joes-hardware.com/tools.html#drills
    - 프래그먼트: drills
    

![](../images/2-3.png)

서버는 객체 일부가 아닌 전체를(작게 나눈 리소스를 잘 다루진 않음) 다루므로 프래그먼트를 서버에서 다루지 않고 클라이언트에서 다룬다.

즉 브라우저가 전체 리소스를 받고 프래그먼트를 사용하여 보고자 하는 리소스 일부만 보는데 사용  

<img src="./images//image-20231019013936697.png" width = 750>

# 2.3 단축 URL

리소스 안에 있는 리소스를 간결하게 기술하는 데 사용

## 상대 URL

URL은 절대 URL과 상대 URL로 나뉜다 

- 절대 URL: 리소스에 접근하는데 필요한 모든 정보를 가지고 있음
- 상대 URL : URL을 짧게 표기하는 방식으로 모든 정보를 담고 있진 않음
  - 프래그먼트나 URL의 일부
  - 스킴, 호스트, 다른 컴포넌트들을 모두 입력하지 않아도 된다

- 기저(base) URL과 상대 URL을 조합해 리소스에 접근하는데 필요한 정보(절대 URL)를 얻음
  - 기저 URL: 상대 URL의 기준이 되는 URL

ex) tools.html파일 

```html
<p> Joe's Hardware Online has the largest selection of 
  <A HREF="./hammers.html">hammers // 상대 URL
```

<img src="./images//image-20231019014151661.png">

- 기저 URL: http://www.joes-hardware.com/
- 상대 URL: ./hammers.html
- 새로운 절대 URL: http://www.joes-hardware.com/hammers.html

URL을 처리하는 브라우저 같은 애플리케이션은 상대 ULR과 절대 URL 간에 상호 변환을 해준다.

**상대 URL을 절대 URL로 변환하기**

<img src="./images//image-20231019014314604.png">

1. ﻿﻿﻿경로는 ./hammers.html. 기저 URL은 http://www.joes-hardware.com/tools.html.
2. ﻿﻿﻿스킴은 비어 있다. 도표의 왼쪽으로 따라 내려가면, 알고리즘에 따라 기저 URL 의 스킴을 상속받는다(HTTP.
3. ﻿﻿﻿적어도 한 개의 컴포넌트는 비어 있지 않다. 아래로 내려가서 호스트와 포트 컴 포넌트를 상속받는다.
4. ﻿﻿﻿상대 URL(경로: ./hammers.html) 컴포넌트와 상속받은 컴포넌트를(스킴:http, 호스트:www.joes-harlware.com, 포트: 80) 합치면, 새로운 절대 URL인 http://www.joes-hardware.com/hammers.html을 얻을 수 있다.

## URL 확장

브라우저들은 URL 을 입력한 다음이나 입력하고 있는 동안에 자동으로 URL 을 확장한다

확장 기능은 2가지로 나뉜다

- 호스트명 확장: 'yahoo' 입력시 자동으로 -> '[www.yahoo.com](http://www.yahoo.com/)' 만들거나 추가적인 몇가지 URL 제시
- 히스토리 확장: 과거에 사용자가 방문했던 URL 을 저장해 놓는 것. www.na 만 쳐도 www.naver.com이 다보임 

# 2.4 안전하지 않은 문자

안전한 전송이란 정보가 유실될 위험 없이 URL을 전송할 수 있다는 것을 의미한다. 

어떤 인터넷 프로토콜을 통해서든 안전하게 전송될 수 있도록 URL 을 설계하는 것은 중요하다

URI 설계자는 사람들이 URL에 이진 데이터나 일반적으로 안전한 알파벳 외의 문자도 포함하려고 할 때가 있다는 것을 알게 되었다. 

그래서 이스케이프라는 기능을 추가하여, 안전하지 않은 문자를 안전 한 문자로 인코딩할 수 있게 하였다.

1. **HTML 이스케이프**:
   - `<` → `<`
   - `>` → `>`
   - `&` → `&`
   - `"` → `"`
   - `'` → `'`
2. **JavaScript 이스케이프**:
   - `'` → `\'`
   - `"` → `\"`
   - `\` → `\\`
   - 줄 바꿈 → `\n`
   - 탭 → `\t`

## URL 문자 집합

컴퓨터 시스템은 보통 US-ASCII 문자 집합을 사용해왔다. US-ASCII 의 경우 만들어진 지 오래된 문자 집합이기 때문에 7비트를 사용하여 적은 수의 문자만을 포함하고 있다. 

그렇기 때문에 전 세계 사람들이 사용하는 언어를 지원하기에는 무리가 있다. 

이런 문제점을 해결하기 위해 URL에 이스케이프 문자열을 쓸 수 있게 설계하였다.

## 인코딩 체계

안전한 문자 집합을 이용하는 경우 표현의 한계를 넘기 위해, URL 에 있는 안전하지 않은 문자들을 표현할 수 있는 인코딩 방식이 고안되었다. 

안전하지 않은 문자를 % 으로 시작해 ASCII 코드로 표현되는 두개의 16 진수 숫자로 이루어진 이스케이프 문자(-, '', %)로 바꾼다.

| 문자 | ASCII 코드 | URL의 예                                                     |
| ---- | ---------- | ------------------------------------------------------------ |
| `~`  | 126 (0x7E) | [http://www.joes-hardware.com/~joe](http://www.joes-hardware.com/~joe) |
| ` `  | 32 (0x20)  | [http://www.joes-hardware.com/more%20tools.html](http://www.joes-hardware.com/more%20tools.html) |
| `%`  | 37 (0x25)  | [http://www.joes-hardware.com/100%25satisfaction.html](http://www.joes-hardware.com/100%25satisfaction.html) |

## 문자 제한

몇몇 문자는 URL 내에서 특별한 의미로 예약되어 있다.

URL에서 예약된 문자들을 사용하려면 반드시 인코딩 해야 하는 문자들이다.

| 문자        | 선점 및 제한                                                 |
| ----------- | ------------------------------------------------------------ |
| %           | 인코딩된 문자에 사용할 이스케이프 토큰으로 선점              |
| /           | 경로 세그먼트를 나누는 용도                                  |
| .           | 경로 컴포넌트에서 선점                                       |
| ..          | 경로 컴포넌트에서 선점                                       |
| #           | 프래그먼트의 구획 문자로 선점                                |
| ?           | 질의 문자열의 구획 문자로 선점                               |
| ;           | 파라미터의 구획 문자로 선점                                  |
| :           | 스킴, 사용자 이름/ 비밀번호, 호스트/포트의 구획 문자로 선점  |
| $, +        | 선점                                                         |
| @ & =       | 특정 스킴에서 특별한 의미가 있기 때문에 선점                 |
| {} \ ~ [] ` | 게이트웨이와 같은 여러 전송 에이전트에서 불안정하게 다루기 때문에 제한됌 |
| <> ""       | 안전하지 않음. URL 범위 밖에서 역할이 있는 문자이기 떄문에 반드시 인코딩 |



# 2.5 스킴의 바다

- http: 일반 URL 포맷을 지키는 하이퍼 텍스트 전송 프로토콜 기본 포트는 80 을 사용한다. 포트값이 생략되어있으면 기본 80
- https: http 와 거의 같다. 커넥션의 양 끝단에서 암호화를 한다. 기본 포트는 443 이다.
- mailto: 이메일 주소를 가리킨다. 표준 URL 과는 다른 포맷을 가진다. 주소의 문법은 RFC822에 기술되어있따.
- ftp: 파일 전송 프로토콜
- rtsp, rtspu: 실시간 스트리밍 프로토콜
- file: 파일 공유 시스템(로컬, 네트워크 파일 시스템 등)에서 바로 접근 할 수 있는 파일들을 나타낸다.
- news: 특정 문서나 뉴스 그룹에 접근하는데 사용한다.
- telnet: 대화형 서비스에 접근하는데 사용된다.



# 2.6 미래

# 2.7 추가 정보

#