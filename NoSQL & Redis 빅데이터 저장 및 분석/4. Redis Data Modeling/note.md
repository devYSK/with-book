# 4장 Redis 데이터 모델링

[toc]

# 4.1 키-밸류(Key-Value) 데이터 모델링 개념

## 4.1.1 용어 설명

### 1. 테이블(Table)

관계형 DB에서 데이터를 저장하는 논리적 구조를 테이블(table)이라고 표현하는 것처럼 Key-Value DB에서도 테이블(Table)이라고 함

### **2. 필드(Field) 또는 엘리먼트(Element)**

하나의 테이블을 구성하고 있는 요소들을 관계형 DB에서는 컬럼(column)이라고 하는데 Key-Value DB에서는 필드(Field) 또는 엘리먼트(Element)라고 말함

레디스는 제약 조건(constraint)을 지정할 수 없다.

### 3. Key-Value DB에서는 하나의 Key와 하나 이상의 필드 또는 엘리먼트로 구성됨

### 4. Key-Value DB에서는 제약 조건 기능이 제공되지 않지만, HyperLogLogs 데이터 속성을 통해 원하는 조건의 데이터를 저장, 관리할 수 있다

## 4.1.2 Redis 데이터 모델링 가이드라인

### **1. Hash 데이터 모델**

**1. Redis의 Hash 데이터 모델과 가장 유사한 관계형 DB의 데이터 모델은 부모-자식 테이블에 해당된다**

예) 주문 테이블과 운송 테이블은 대표적인 부모-자식 테이블로, 운송 테이블은 주문 테이블이 먼저 생성되어야만 생성될 수 있는 데이터 구조라고 볼 수 있다

**2. 데이터 관계를 Redis DB에서 구현할 때 Hash 모델을 선택하면 된다**

### 2. List 데이터 모델

**1. Redis의 List 데이터 모델과 가장 유사한 관계형 DB의 데이터 모델은 마스터-디테일 테이블에 해당된다**

예) 주문 전표를 관계형 DB의 분석/설계(정규화) 과정을 거치게 되면 주문 공통 테이블과 주문 상세 테이블로 설계할 수 있다

→ Master와 Detail 데이터를 모두 합치게 되면 주문 전표라는 하나의 완전한 데이터 구조로 표현하게 된다

**2. List 타입은 객체지향 프로그래밍 언어에서 사용되는 배열 구조와 유사하다**

### 3. Set/Sorted Set 데이터 모델

**1. Redis의 Set/Sorted Set 데이터 모델과 가장 유사한 관계형 DB의 데이터 모델은 계층형(Tree Structure) 테이블에 해당된다**

> SELF-Reference 관계까 필요하다면 Set/Sorted Set 모델을 선택하면 된다.

예) 사원 테이블은 사원 번호가 식별키이고, 상관 사원번호 컬럼은 같은 테이블 내에 식별키인 사원번호를 참조하는 관계구조를 가짐



### 4. HyperLogLogs 데이터 모델

**1. Redis DB의 HyperLogLogs 데이터 모델과 가장 유사한 관계형 DB의 데이터 모델은 Check 제약조건에 해당됨**

**2. 일반적으로 관계형 테이블의 특정 컬럼에 제한된 값만을 저장해야 하는 경우 3가지 방법을 통해 구현할 수 있다**

*  애플리케이션을 통해 데이터를 입력 및 수정할 때 조건을 만족하는 데이터인지 여부를 확인하는 방법

* 특정 조건의 데이터 값을 임의의 테이블에 미리 저장해둔 다음 해당 테이블에 데이터를 입력 및 수정할 때 임의의 테이블과 식별키와 외부키로 검증하는 방법

*  해당 테이블을 생성할 때 특정 컬럼에 Check 제약조건을 설정해 두는 방법

**3. 일반적으로 해당 컬럼에 저장할 데이터가 원치 않는 데이터가 입력 및 변경되는 것을 방지하기 위한 목적으로 사용된다**

## 4.1.3 데이터 모델

**Redis Server에서 설계할 수 있는 데이터 모델 유형**

\- Hash-Hash Data Model

\- Hash-List Data Model

\- List-List Data Model

\- Set/Sorted Set-List Data Model

\- HyperLogLogs Data Model



# 4.2 논리적 DB 설계

**1. 하나의 Redis 서버는 여러 개의 데이터베이스로 구성됨**

기본적으로 논리적 데이터베이스 16개를 생성할 수 있는데, 필요에 따라 더 많은 수의 데이터베이스를 생성할 수 있음

**2. 스트라이핑(Striping) 기법**

데이터의 안전한 저장 및 관리를 위해 기본적으로 분리 저장을 원칙으로 하는것이 좋다

**3. 데이터의 백업 및 복구 측면에서 하나의 DB로 생성하는 것 보다 여러 개의 DB로 분리 생성하는 것이 유리함**

\- 하나의 데이터베이스에 모든 테이블과 인덱스를 생성 관리하다 보면 얘기치 못한 다양한 장애가 발생하는 경우, 장애 범위가 너무 넓어 빠른 시간 내에 복구하기 쉽지 않고 장애로 인한 서비스 지연 문제를 피할 수 없음

\- 유연성 있게 운영하기 위해서는 업무별로 여러 개의 데이터베이스에 분산 저장하는 것이 좋음

**4) 분산 Database Lock을 지원하기 때문에 보다 세분화된 DB 설계가 요구됨**

\- 데이터베이스 기술은 데이터를 입력, 수정, 삭제, 조회 시 다양한 락(Lock) 현상으로 인해 성능 이슈가 발생할 수 있음

\- 최소화하기 위해서 논리적으로 여러 개의 데이터베이스로 분산 설계하고 구축하는 것이 좋음

conf 환경설정 파일의 database 파라미터에 의해 개수를 결정하고, redis-cli.exe 셸에서 select 문으로 해당 데이터베이스로 이동할 수 있다



## 4.3 SWapDB 설계

**1. Redis 4.0.0 버전부터 swapDB 기능을 제공함**

\- 빅데이터의 분류(Sorting) 작업이 요구되는 경우, 메모리 부족으로 인한 일시적인 지연 문제들이 발생할 수 있어 이를 보완하기 위한 기능을 말함

\- 기존 관계형 데이터베이스에서 제공하는 임시 테이블스페이스 또는 임시 데이터베이스와 유사한 구조를 말함

**2. 모든 클라이언트들은 해당 swapDB에 즉시 접속하여 다른 Local DB 데이터를 빠르게 처리할 수 있음**

운영체제에서의 swap 메모리와 유사한 개념을 말함